@using Microsoft.AspNetCore.Identity
@using AryTickets.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@RenderBody()
@RenderSection("Scripts", required: false)
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - AryTix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    @await RenderSectionAsync("Styles", required: false)
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #111827;
            color: #F3F4F6;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1F2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #4F46E5;
            border-radius: 10px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #6366F1;
            }

        .nav-scrolled {
            background-color: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .dropdown-menu {
            transition: opacity 0.2s, transform 0.2s;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <header id="navbar" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-6">
                <a asp-area="" asp-controller="Home" asp-action="Index" class="text-3xl font-bold text-white">
                    <span class="text-indigo-500">Ary</span>Tix
                </a>
                <div class="relative" id="regionDropdownContainer">
                    <button id="regionDropdownButton" class="flex items-center space-x-2 px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        <span id="currentRegionText">@ViewData["CurrentRegion"]</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="regionDropdownMenu" class="dropdown-menu absolute mt-2 w-48 bg-gray-800 rounded-lg shadow-xl opacity-0 transform scale-95 pointer-events-none">
                        <a href="/Home/Index?region=US" class="block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600 rounded-t-lg">United States</a>
                        <a href="/Home/Index?region=GB" class="block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600">United Kingdom</a>
                        <a href="/Home/Index?region=CA" class="block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600">Canada</a>
                        <a href="/Home/Index?region=AU" class="block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600 rounded-b-lg">Australia</a>
                    </div>
                </div>
            </div>
            <div class="hidden md:flex items-center space-x-8">
                <a asp-area="" asp-controller="Home" asp-action="Index" class="hover:text-indigo-400 transition-colors">Home</a>
                <a href="#" class="hover:text-indigo-400 transition-colors">Movies</a>
                <a href="#" class="hover:text-indigo-400 transition-colors">Theatres</a>
            </div>
            <div class="flex items-center space-x-4">
                @if (SignInManager.IsSignedIn(User))
                {
                    <div class="relative" id="userDropdownContainer">
                        <button id="userDropdownButton" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-gray-600 transition">
                            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"></path></svg>
                        </button>
                        <div id="userDropdownMenu" class="dropdown-menu absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl opacity-0 transform scale-95 pointer-events-none">
                            <div class="px-4 py-3 border-b border-gray-700">
                                <p class="text-sm text-white">Signed in as</p>
                                <p class="text-sm font-medium text-gray-300 truncate">@User.Identity?.Name</p>
                            </div>
                            <div class="py-1">
                                <a asp-controller="Profile" asp-action="Index" class="block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600">My Profile</a>
                                <form class="w-full" asp-area="" asp-controller="Account" asp-action="Logout" method="post">
                                    <button type="submit" class="w-full text-left block px-4 py-2 text-sm text-gray-300 hover:bg-indigo-600">Sign out</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <a asp-controller="Account" asp-action="Login" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-all duration-300 transform hover:scale-105">
                        Login
                    </a>
                }
            </div>
        </nav>
    </header>

    <main role="main">
        @RenderBody()
    </main>

    <footer class="bg-gray-900 border-t border-gray-700">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <a href="/" class="text-2xl font-bold text-white"><span class="text-indigo-500">Ary</span>Tix</a>
                    <p class="text-sm text-gray-400 mt-1">Your ultimate entertainment hub.</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">About</a>
                    <a asp-area="" asp-controller="Home" asp-action="Privacy" class="text-gray-400 hover:text-white transition-colors">Privacy</a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">FAQ</a>
                </div>
            </div>
            <div class="text-center text-gray-500 mt-8 pt-6 border-t border-gray-800">
                &copy; @DateTime.Now.Year AryTix. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        window.addEventListener('scroll', function () {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) navbar.classList.add('nav-scrolled');
            else navbar.classList.remove('nav-scrolled');
        });

        function setupDropdown(containerId, buttonId, menuId) {
            const container = document.getElementById(containerId);
            const button = document.getElementById(buttonId);
            const menu = document.getElementById(menuId);

            if (container && button && menu) {
                button.addEventListener('click', (event) => {
                    event.stopPropagation();
                    menu.classList.toggle('opacity-0');
                    menu.classList.toggle('scale-95');
                    menu.classList.toggle('pointer-events-none');
                });

                window.addEventListener('click', function (e) {
                    if (!container.contains(e.target)) {
                        menu.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                    }
                });
            }
        }

        setupDropdown('regionDropdownContainer', 'regionDropdownButton', 'regionDropdownMenu');
        setupDropdown('userDropdownContainer', 'userDropdownButton', 'userDropdownMenu');
    </script>
</body>
</html>